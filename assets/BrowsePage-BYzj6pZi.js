import{c as L,$ as G,n as R,o as _,r as f,j as s,m as a}from"./index-CKYMUaQW.js";import{u as D}from"./use-browse-B_-10Gwg.js";import{M as I,a as A,b as B}from"./MangaGrid-njmF1wgV.js";import{G as N}from"./GenreBadge-Dg3D-IgT.js";import{H as O}from"./HorizontalScroll-CyFzq9em.js";import{L as U}from"./loader-circle-CIsMr-Yr.js";import"./utils-BDo7o5Y5.js";const V=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],T=L("chevron-down",V);function q(n){return G.useInfiniteQuery("get","/api/v1/browse/",{params:{query:{page:1,limit:24,sort:n.sort??"latest",genres:n.genres,status:n.status,isAdult:n.isAdult}}},{pageParamName:"page",getNextPageParam:o=>{if(o.pagination.hasMore)return String(o.pagination.page+1)},initialPageParam:"1",placeholderData:R})}const y=[{label:a.browse.sortLatest,value:"latest"},{label:a.browse.sortViewsDay,value:"views_day"},{label:a.browse.sortViewsWeek,value:"views_week"},{label:a.browse.sortViewsMonth,value:"views_month"}],E=new Set(y.map(n=>n.value));function K(){const[n,o]=_(),c=n.get("sort"),u=n.get("genres"),p=c&&E.has(c)?c:"latest",i=f.useMemo(()=>u?u.split(",").map(Number).filter(e=>!isNaN(e)):[],[u]),{data:h}=D(),P=f.useMemo(()=>i.length>0?i.join(","):void 0,[i]),{data:d,isLoading:x,isFetchingNextPage:l,hasNextPage:b,fetchNextPage:S}=q({sort:p,genres:P}),v=f.useMemo(()=>{if(!d?.pages)return[];const e=new Set;return d.pages.flatMap(t=>t.data.filter(r=>e.has(r.id)?!1:(e.add(r.id),!0)))},[d?.pages]),k=e=>{o(t=>{const r=new URLSearchParams(t);return e==="latest"?r.delete("sort"):r.set("sort",e),r},{replace:!0})},w=e=>{o(t=>{const r=new URLSearchParams(t),m=t.get("genres")?.split(",").map(Number).filter(g=>!isNaN(g))||[],j=m.includes(e)?m.filter(g=>g!==e):[...m,e];return j.length===0?r.delete("genres"):r.set("genres",j.join(",")),r},{replace:!0})},M=()=>{o(e=>{const t=new URLSearchParams(e);return t.delete("genres"),t},{replace:!0})},C=()=>{b&&!l&&S()};return s.jsxs(s.Fragment,{children:[s.jsx("title",{children:a.titles.browse}),s.jsxs("div",{className:"py-4 md:py-6 space-y-4 md:space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"hidden md:block text-xl sm:text-2xl font-semibold tracking-tight",children:a.browse.title}),s.jsxs("div",{className:"relative md:ml-auto",children:[s.jsx("select",{value:p,onChange:e=>k(e.target.value),className:"h-9 pl-3 pr-8 rounded-lg bg-muted text-sm font-medium text-foreground appearance-none cursor-pointer hover:bg-border transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:y.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))}),s.jsx(T,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"})]})]}),i.length>0&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-xs text-muted-foreground",children:a.browse.selectedGenres}),s.jsx("div",{className:"flex flex-wrap gap-1.5",children:i.map(e=>{const t=h?.data?.find(r=>r.id===e);return t?s.jsx(N,{name:t.name,onClick:()=>w(e),selected:!0,showClose:!0},e):null})}),s.jsx("button",{type:"button",onClick:M,className:"text-xs text-muted-foreground hover:text-foreground transition-colors ml-2 rounded focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:a.common.clearAll})]}),s.jsx(O,{gap:"sm",snap:!1,fullBleed:!1,className:"pb-2",children:h?.data?.map(e=>s.jsx(N,{name:e.name,onClick:()=>w(e.id),selected:i.includes(e.id)},e.id))}),x?s.jsx(I,{count:18}):s.jsx(A,{children:v.map(e=>s.jsx(B,{id:e.id.toString(),title:e.title,coverUrl:e.image??"/placeholder.svg",latestChapter:e.latestChapter?.title},e.id))}),!x&&v.length===0&&s.jsx("div",{className:"py-12 text-center text-muted-foreground",children:a.browse.noResults}),b&&s.jsx("div",{className:"flex justify-center pt-4",children:s.jsxs("button",{type:"button",onClick:C,disabled:l,className:"h-9 px-5 bg-primary text-primary-foreground rounded-lg text-sm font-medium hover:opacity-90 active:scale-[0.98] transition-all disabled:opacity-50 inline-flex items-center focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[l&&s.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}),l?a.common.loading:a.common.loadMore]})})]})]})}export{K as default};
