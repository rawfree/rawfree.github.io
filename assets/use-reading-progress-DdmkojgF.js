import{l as y,r as u}from"./index-CKYMUaQW.js";function w({mangaId:r,mangaTitle:o,mangaCover:e,chapterId:s,chapterTitle:f,totalPages:R,debounceMs:g=1e3}){const{saveProgress:l,getProgress:A,isLoaded:i,loadProgress:S}=y(),t=u.useRef(null),d=u.useRef(null);u.useEffect(()=>{i||S()},[i,S]);const a=A(r),E=u.useCallback((c,n)=>{t.current&&clearTimeout(t.current),!(d.current?.page===c&&d.current?.scroll===n)&&(t.current=setTimeout(()=>{const P={mangaId:r,mangaTitle:o,mangaCover:e,chapterId:s,chapterTitle:f,currentPage:c,totalPages:R,scrollPosition:n,lastReadAt:new Date().toISOString()};l(P),d.current={page:c,scroll:n??0}},g))},[r,o,e,s,f,R,g,l]),L=u.useCallback((c,n)=>{t.current&&clearTimeout(t.current);const v={mangaId:r,mangaTitle:o,mangaCover:e,chapterId:s,chapterTitle:f,currentPage:c,totalPages:R,scrollPosition:n,lastReadAt:new Date().toISOString()};l(v),d.current={page:c,scroll:n??0}},[r,o,e,s,f,R,l]);return u.useEffect(()=>()=>{t.current&&clearTimeout(t.current)},[]),{currentProgress:i&&a?.chapterId===s&&a?.currentPage>0?a:void 0,saveProgress:E,saveImmediately:L,isLoaded:i}}function x(r=5){const{getRecentlyRead:o,isLoaded:e,loadProgress:s}=y();return u.useEffect(()=>{e||s()},[e,s]),{recentlyRead:e?o(r):[],isLoaded:e}}export{w as a,x as u};
