import{c as L,j as e,N as j,u as M,r as i,X as g,L as T,a as F,b as H,d as I,p as K,e as E,f as D,g as A,h as V,S as O,O as Q}from"./index-CKYMUaQW.js";import{c as d}from"./utils-BDo7o5Y5.js";import{H as X}from"./house-D9wCVk4D.js";import{B as U}from"./bookmark-hM7DXn_N.js";import{S as _}from"./settings-B8ARuyRh.js";import{u as P,S as y}from"./use-search-history-Bbe8l775.js";import{u as W,a as q}from"./use-browse-B_-10Gwg.js";import{M as Y,a as J,b as Z}from"./MangaGrid-njmF1wgV.js";import{G as ee}from"./GenreBadge-Dg3D-IgT.js";import{A as te}from"./arrow-left-CQkoRQDD.js";import{C as se}from"./clock-DIK97DkU.js";import{T as ne}from"./trending-up-ErCEaXOo.js";import{T as re}from"./trash-2-BjqcsBRE.js";const ae=[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ie=L("compass",ae);const oe=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],le=L("database",oe),z=[{to:"/",icon:X,label:"Trang ch·ªß"},{to:"/browse",icon:ie,label:"Kh√°m ph√°"},{to:"/bookmarks",icon:U,label:"Y√™u th√≠ch"},{to:"/settings",icon:_,label:"C√†i ƒë·∫∑t"}];function ce(){return e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bg-background shadow-[0_-1px_3px_rgba(0,0,0,0.05)] dark:shadow-[0_-1px_3px_rgba(0,0,0,0.3)] md:hidden",style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:e.jsx("div",{className:"grid grid-cols-4 h-14",children:z.map(({to:s,icon:r,label:o})=>e.jsx(j,{to:s,className:({isActive:n})=>d("flex flex-col items-center justify-center gap-1","min-h-[48px] touch-manipulation","active:opacity-70","focus-visible:outline-none focus-visible:bg-muted/50",n?"text-foreground":"text-muted-foreground"),children:({isActive:n})=>e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"w-6 h-6",strokeWidth:1.5}),e.jsx("span",{className:d("text-[10px]",n?"font-semibold":"font-medium"),children:o})]})},s))})})}function de({open:s,onClose:r}){const o=M(),n=i.useRef(null),[a,m]=i.useState(""),[u,l]=i.useState(""),{history:x,addSearch:c,removeSearch:b,clearHistory:p}=P(),{data:N}=W("popular"),k=u.length>2,{data:w,isLoading:S}=q(k?u:""),f=i.useMemo(()=>w?.data??[],[w]),R=i.useMemo(()=>(N?.data||[]).slice(0,8),[N]);i.useEffect(()=>{s&&n.current&&n.current.focus(),s||(m(""),l(""))},[s]),i.useEffect(()=>{if(!a.trim()){l("");return}const t=setTimeout(()=>{l(a.trim())},300);return()=>clearTimeout(t)},[a]),i.useEffect(()=>{if(!s)return;const t=h=>{h.key==="Escape"&&r()};return document.addEventListener("keydown",t),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",t),document.body.style.overflow=""}},[s,r]);const v=t=>{const h=t.trim();h&&(c(h),o(`/search?q=${encodeURIComponent(h)}`),r())},$=t=>{o(`/browse?genres=${t}`),r()},B=t=>{c(t),r()};if(!s)return null;const C=k,G=!C&&a.length===0;return e.jsx("div",{className:"fixed inset-0 z-50 bg-background",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("header",{className:"flex items-center gap-2 px-2 h-14 border-b border-border safe-area-top",children:[e.jsx("button",{type:"button",onClick:r,className:"size-10 flex items-center justify-center rounded-full hover:bg-muted transition-colors","aria-label":"ƒê√≥ng",children:e.jsx(te,{className:"w-5 h-5"})}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),v(a)},className:"flex-1 relative",children:[e.jsx(y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx("input",{ref:n,type:"text",value:a,onChange:t=>m(t.target.value),placeholder:"T√¨m ki·∫øm truy·ªán...",className:"w-full h-10 pl-9 pr-9 bg-muted rounded-xl text-[max(16px,0.875rem)] placeholder:text-muted-foreground focus:outline-none"}),a&&e.jsx("button",{type:"button",onClick:()=>m(""),className:"absolute right-2 top-1/2 -translate-y-1/2 size-6 flex items-center justify-center rounded-full hover:bg-background/50",children:e.jsx(g,{className:"w-4 h-4 text-muted-foreground"})})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"container mx-auto px-3 py-4 space-y-6",children:[G&&e.jsxs(e.Fragment,{children:[x.length>0&&e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"T√¨m ki·∫øm g·∫ßn ƒë√¢y"})]}),e.jsx("button",{type:"button",onClick:p,className:"text-xs text-muted-foreground hover:text-foreground transition-colors",children:"X√≥a t·∫•t c·∫£"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(t=>e.jsxs("button",{type:"button",onClick:()=>{m(t),v(t)},className:"group flex items-center gap-1.5 h-8 pl-3 pr-1.5 bg-muted rounded-lg text-sm hover:bg-border transition-colors",children:[e.jsx("span",{children:t}),e.jsx("button",{type:"button",onClick:h=>{h.stopPropagation(),b(t)},className:"size-5 flex items-center justify-center rounded-full hover:bg-background/50","aria-label":`X√≥a ${t}`,children:e.jsx(g,{className:"w-3 h-3 text-muted-foreground"})})]},t))})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Th·ªÉ lo·∫°i ph·ªï bi·∫øn"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(t=>e.jsx(ee,{name:t.name,onClick:()=>$(t.id)},t.id))})]})]}),a.length>0&&a.length<=2&&e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Nh·∫≠p √≠t nh·∫•t 3 k√Ω t·ª± ƒë·ªÉ t√¨m ki·∫øm"}),C&&e.jsxs("section",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:S?"ƒêang t√¨m...":`${f.length} k·∫øt qu·∫£`}),S?e.jsx(Y,{count:6}):f.length>0?e.jsx(J,{children:f.slice(0,12).map(t=>e.jsx(T,{to:`/manga/${t.id}`,onClick:()=>B(t.title),children:e.jsx(Z,{id:t.id.toString(),title:t.title,coverUrl:t.image??"/placeholder.svg",latestChapter:t.latestChapter?.title})},t.id))}):e.jsxs("div",{className:"text-center text-muted-foreground py-8",children:['Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ cho "',u,'"']}),f.length>12&&e.jsx("div",{className:"text-center pt-4",children:e.jsxs("button",{type:"button",onClick:()=>v(u),className:"h-10 px-6 bg-muted rounded-xl text-sm font-medium hover:bg-border transition-colors",children:["Xem t·∫•t c·∫£ ",f.length," k·∫øt qu·∫£"]})})]})]})})]})})}function me(){const s=M(),r=F(),[o,n]=i.useState(!1),[a,m]=i.useState(""),u=H(10),l=r.pathname==="/",x=c=>{c.key==="Enter"&&a.trim()&&(s(`/search?q=${encodeURIComponent(a.trim())}`),m(""))};return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:d("sticky top-0 z-40 bg-background",u&&"shadow-sm",!l&&"hidden md:block"),style:{paddingTop:"env(safe-area-inset-top, 0px)"},children:e.jsxs("div",{className:"container mx-auto px-4 h-14 sm:h-16 flex items-center justify-between gap-4",children:[e.jsx(T,{to:"/",className:"font-bold text-xl sm:text-2xl tracking-tight text-foreground rounded focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:"MangaRaw"}),e.jsx("nav",{className:"hidden md:flex items-center gap-1",children:z.slice(0,3).map(({to:c,label:b})=>e.jsx(j,{to:c,className:({isActive:p})=>d("h-9 px-4 flex items-center text-sm font-medium transition-colors rounded-lg","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",p?"bg-muted text-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:b},c))}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"hidden md:block relative",children:[e.jsx(y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),e.jsx("input",{type:"text",placeholder:"T√¨m ki·∫øm...",value:a,onChange:c=>m(c.target.value),onKeyDown:x,className:"w-48 lg:w-64 h-9 pl-9 pr-4 bg-muted rounded-lg text-[max(16px,0.875rem)] placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-all"})]}),e.jsx("button",{type:"button",onClick:()=>n(!0),className:"md:hidden size-10 flex items-center justify-center rounded-full hover:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background","aria-label":"T√¨m ki·∫øm",children:e.jsx(y,{className:"w-5 h-5"})}),e.jsx(j,{to:"/settings",className:({isActive:c})=>d("hidden md:flex size-9 items-center justify-center rounded-lg transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",c?"bg-muted text-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),"aria-label":"C√†i ƒë·∫∑t",children:e.jsx(_,{className:"w-5 h-5"})})]})]})}),e.jsx(de,{open:o,onClose:()=>n(!1)})]})}const ue=I()(K((s,r)=>({dismissedAnnouncements:[],dismissAnnouncement:o=>s(n=>({dismissedAnnouncements:[...n.dismissedAnnouncements,o]})),isAnnouncementDismissed:o=>r().dismissedAnnouncements.includes(o),clearDismissed:()=>s({dismissedAnnouncements:[]})}),{name:"manga-dismissed"}));function xe(){const{config:s}=E(),{isAnnouncementDismissed:r,dismissAnnouncement:o}=ue(),n=s.announcement;if(!n||r(n.id))return null;const a={info:"bg-blue-500/10 text-blue-600 dark:text-blue-400 border-blue-500/20",warning:"bg-yellow-500/10 text-yellow-600 dark:text-yellow-400 border-yellow-500/20",error:"bg-red-500/10 text-red-600 dark:text-red-400 border-red-500/20"};return e.jsx("div",{className:d("border-b px-4 py-3",a[n.type]),children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-sm flex-1",children:[n.message,n.link&&e.jsx("a",{href:n.link,target:"_blank",rel:"noopener noreferrer",className:"underline ml-2 font-medium",children:"Xem th√™m ‚Üí"})]}),n.dismissible&&e.jsx("button",{type:"button",onClick:()=>o(n.id),className:"p-1 rounded hover:bg-black/10 dark:hover:bg-white/10 transition-colors","aria-label":"Dismiss",children:e.jsx(g,{className:"w-4 h-4"})})]})})}function he({message:s,estimatedEnd:r}){return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:e.jsxs("div",{className:"max-w-md text-center",children:[e.jsx("div",{className:"text-6xl mb-6",children:"üîß"}),e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-4",children:"ƒêang b·∫£o tr√¨"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s}),r&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["D·ª± ki·∫øn ho√†n th√†nh: ",new Date(r).toLocaleString("vi-VN")]})]})})}function fe(){const[s,r]=i.useState(null),[o,n]=i.useState(!0),[a,m]=i.useState(!1);if(i.useEffect(()=>{D().then(r)},[]),!s||!o||!s.warning&&!s.critical)return null;const u=async()=>{m(!0);try{await V();const x=await D();r(x)}catch(x){console.error("Failed to clear cache:",x)}finally{m(!1)}},l=s.critical;return e.jsx("div",{className:d("relative mb-6 overflow-hidden rounded-xl border p-4 transition-all duration-300 ease-in-out",l?"bg-destructive/5 border-destructive/20":"bg-amber-500/5 border-amber-500/20"),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:d("flex h-10 w-10 shrink-0 items-center justify-center rounded-full",l?"bg-destructive/10 text-destructive":"bg-amber-500/10 text-amber-600 dark:text-amber-500"),children:e.jsx(le,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:d("font-semibold tracking-tight",l?"text-destructive":"text-amber-700 dark:text-amber-500"),children:l?"Dung l∆∞·ª£ng s·∫Øp ƒë·∫ßy":"C·∫£nh b√°o dung l∆∞·ª£ng"}),e.jsx("button",{type:"button",onClick:()=>n(!1),className:"text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(g,{className:"h-4 w-4"})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["B·∫°n ƒëang s·ª≠ d·ª•ng ",e.jsx("span",{className:"font-medium text-foreground",children:A(s.used)})," tr√™n t·ªïng s·ªë ",e.jsx("span",{className:"font-medium text-foreground",children:A(s.total)})," (",Math.round(s.percentage*100),"%).",l&&" Vui l√≤ng d·ªçn d·∫πp b·ªô nh·ªõ ƒë·ªám ƒë·ªÉ ƒë·∫£m b·∫£o ·ª©ng d·ª•ng ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh."]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("div",{className:"h-2 flex-1 overflow-hidden rounded-full bg-secondary/50",children:e.jsx("div",{className:d("h-full transition-all duration-500",l?"bg-destructive":"bg-amber-500"),style:{width:`${Math.min(s.percentage*100,100)}%`}})}),e.jsx("button",{type:"button",onClick:u,disabled:a,className:d("flex items-center gap-1.5 rounded-md px-3 py-1 text-xs font-medium transition-colors focus:outline-none focus-visible:outline-2 focus-visible:outline-offset-2",l?"bg-destructive text-destructive-foreground hover:bg-destructive/90 focus-visible:outline-destructive":"bg-amber-500 text-white hover:bg-amber-600 focus-visible:outline-amber-500",a&&"opacity-50 cursor-not-allowed"),children:a?"ƒêang d·ªçn...":e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3"}),"D·ªçn b·ªô nh·ªõ"]})})]})]})]})})}function ge(){return e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})})}function Me(){const{config:s}=E();return s.maintenance?.enabled?e.jsx(he,{message:s.maintenance.message,estimatedEnd:s.maintenance.estimatedEnd}):e.jsxs("div",{className:"min-h-screen min-h-dvh bg-background pb-[72px] md:pb-0",children:[e.jsx(me,{}),e.jsx(xe,{}),e.jsxs("main",{className:"container mx-auto px-4 overflow-x-clip",children:[e.jsx(O,{}),e.jsx(fe,{}),e.jsx(i.Suspense,{fallback:e.jsx(ge,{}),children:e.jsx(Q,{})})]}),e.jsx(ce,{})]})}export{Me as RootLayout};
